{% extends "base.html" %}
{% block title %}Dashboard ‚Äî ZeaControl{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Dashboard</h1>
    <p>–û–±–∑–æ—Ä –≤—Å–µ—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ –∏ —Å–µ—Ä–≤–µ—Ä–æ–≤</p>
</div>

<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<div class="stats-grid">
    <div class="stat-card total">
        <div class="stat-icon">üì¶</div>
        <div class="stat-value">{{ stats.total }}</div>
        <div class="stat-label">–í—Å–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–æ–≤</div>
    </div>
    <div class="stat-card active">
        <div class="stat-icon">üü¢</div>
        <div class="stat-value">{{ stats.active }}</div>
        <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö</div>
    </div>
    <div class="stat-card grace">
        <div class="stat-icon">üü°</div>
        <div class="stat-value">{{ stats.grace }}</div>
        <div class="stat-label">Grace-–ø–µ—Ä–∏–æ–¥</div>
    </div>
    <div class="stat-card suspended">
        <div class="stat-icon">üî¥</div>
        <div class="stat-value">{{ stats.suspended }}</div>
        <div class="stat-label">–ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ</div>
    </div>
</div>

<!-- –¢–∞–±–ª–∏—Ü–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤ -->
<div class="card">
    <div class="card-header">
        <h2>üìã –ü—Ä–æ–µ–∫—Ç—ã</h2>
        <a href="/admin/projects/project/add/" class="btn btn-primary btn-sm">+ –î–æ–±–∞–≤–∏—Ç—å</a>
    </div>
    <div class="table-wrapper">
        {% if projects %}
        <table>
            <thead>
                <tr>
                    <th>–ü—Ä–æ–µ–∫—Ç</th>
                    <th>–î–æ–º–µ–Ω</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–°–µ—Ä–≤–µ—Ä</th>
                    <th>–ü–æ—Ä—Ç</th>
                    <th>–ü–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–ø–ª–æ–π</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for project in projects %}
                <tr>
                    <td>
                        <a href="{% url 'project_detail' project.slug %}" class="project-link">
                            {{ project.name }}
                        </a>
                    </td>
                    <td>
                        {% if project.domain %}
                        <a href="https://{{ project.domain }}" target="_blank" class="domain-link">{{ project.domain
                            }}</a>
                        {% else %}
                        <span style="color: var(--text-muted)">‚Äî</span>
                        {% endif %}
                    </td>
                    <td>
                        <span class="badge badge-{{ project.status }}">{{ project.get_status_display }}</span>
                    </td>
                    <td>{{ project.server.name }}</td>
                    <td>{{ project.internal_port }}</td>
                    <td>
                        {% if project.last_deploy_at %}
                        {{ project.last_deploy_at|date:"d.m.Y H:i" }}
                        {% else %}
                        <span style="color: var(--text-muted)">‚Äî</span>
                        {% endif %}
                    </td>
                    <td>
                        <div class="btn-group">
                            {% if project.status != "deploying" %}
                            <form method="post" action="{% url 'project_action' project.slug 'deploy' %}"
                                class="action-form">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-primary btn-sm" title="Deploy">üöÄ</button>
                            </form>
                            {% endif %}
                            {% if project.status == "active" or project.status == "grace" %}
                            <form method="post" action="{% url 'project_action' project.slug 'suspend' %}"
                                class="action-form">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-danger btn-sm" title="Suspend">‚õî</button>
                            </form>
                            {% endif %}
                            {% if project.status == "suspended" %}
                            <form method="post" action="{% url 'project_action' project.slug 'resume' %}"
                                class="action-form">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-success btn-sm" title="Resume">‚ñ∂Ô∏è</button>
                            </form>
                            {% endif %}
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="empty-state">
            <div class="empty-icon">üì≠</div>
            <p>–ù–µ—Ç –ø—Ä–æ–µ–∫—Ç–æ–≤. <a href="/admin/projects/project/add/" class="project-link">–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—ã–π –ø—Ä–æ–µ–∫—Ç</a></p>
        </div>
        {% endif %}
    </div>
</div>

<!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–µ–ø–ª–æ–∏ -->
<div class="card">
    <div class="card-header">
        <h2>üïê –ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è</h2>
    </div>
    <div class="card-body">
        {% if recent_deployments %}
        <ul class="timeline">
            {% for dep in recent_deployments %}
            <li class="timeline-item">
                <div class="timeline-dot {{ dep.status }}"></div>
                <div class="timeline-content">
                    <div class="timeline-time">{{ dep.started_at|date:"d.m.Y H:i" }}</div>
                    <div class="timeline-text">
                        <strong>{{ dep.project.name }}</strong> ‚Äî
                        <span class="badge badge-{{ dep.action }} btn-sm">{{ dep.get_action_display }}</span>
                        <span class="badge badge-{{ dep.status }} btn-sm">{{ dep.get_status_display }}</span>
                    </div>
                </div>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <div class="empty-state">
            <div class="empty-icon">üì≠</div>
            <p>–ù–µ—Ç –¥–µ–π—Å—Ç–≤–∏–π</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}